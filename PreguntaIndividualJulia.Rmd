---
title: "PreguntaJulia"
author: "Julia"
date: "2024-03-06"
output: html_document
---
Introducción

Este proyecto pretende proporcionar una exploración adecuada sobre la relación entre los trastornos mentales, como la depresión y los problemas de alcoholismo y las tasas de suicidio a nivel mundial empleando técnicas estadísticas como los contrastes de hipótesis para determinar la importancia significativa entre las enfermedades mentales que mayor correlación presentan con respecto a la tasa de suicidio en función de los resultados obtenidos en el proyecto grupal.

Además, se emplea un modelo de árbol de regresión para comprender cómo se relacionan las variables predictoras (seleccionadas en la etapa anterior) con la tasa de suicidio, ofreciendo una visión más clara de los factores que contribuyen a este importante problema de salud mental pública.

La aplicación de técnicas de series temporales también se destaca en el proyecto, permitiendo estimar las tasas de suicidio en los próximos años, así como la predicción del porcentaje de las enfermedades contrastadas.

En resumen, el proyecto proporciona una comprensión integral de la relación entre los trastornos mentales más significativos y las tasas de suicidio a nivel mundial, ofreciendo información valiosa para abordar este importante problema de salud pública.


Para este proyecto, hemos escogido el conjunto de datos elaborado y obtenido en el trabajo grupal de la asignatura. Recordamos que este dataset estaba compuesto por uno de los cuatro datasets relacionados con los porcentajes de enfermedades mentales a nivel mundial más el dataset que contiene información sobre la tasa de suicidios por género, año y país que había sido elaborado y preprocesado por parte de los miembros del equipo del proyecto grupal de la asignatura en la cual yo misma he participado.

```{r}
data <- read.csv("data/dataMH.csv")
head(data)
```

Como no todas las columnas me aportan la información, decido eliminar la columna "CODE" pues presenta, de forma resumida, el nombre de los países que componen el conjunto de datos y, además es una variable de tipo "character" que no permite ser analizada mediante técnicas estadísticas, como veremos a continuación, al igual que la variable "DIM_SEX":

```{r}
data <- subset(data, select = -c(Code, DIM_SEX))
head(data)
```

Cálculo de la correlación de las distintas variables:

En este apartado se obtiene una representación de la matriz de correlación con el fin de descubrir cuales son las enfermedades mentales más relacionadas con la tasa de suicidios. Además, esta matriz de correlación nos servirá en un futuro de cara al contraste de hipótesis para observar las dos variables que representan una correlación significativa respecto a la tasa de suicidios a nivel mundial.

```{r}
library(dplyr)
library(corrplot)


data <- data %>% rename(SuicideRate = VALUE_NUMERIC)

data_total <- data[, c("Schizophrenia", "Bipolar.disorders", "Eating.disorders", "Anxiety.disorders", "Drug.use.disorders", "Depression", "Alcohol.use.disorders", "SuicideRate")]

correlation_matrix <- cor(data_total, use = "pairwise.complete.obs")

corrplot(correlation_matrix, method = "color", type = "upper", order = "hclust", 
         tl.cex = 0.8, tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)
```
Una vez obtenida la matriz de correlación, observamos que los trastornos por enfermedad mental con mayor correlación corresponden con las variables que representan a enfermedades mentales: trastornos mentales debidos al alcoholismo ("Alcohol.use.disorders"), con un 0.47, y, depresión ("Depression"), con un 0.32.


Contraste de hipótesis 

En este apartado se presentan dos contrastes de hipótesis entre las variables de mayor correlación con la tasa de suicidios para  poder contrastar si estas enfermedades mentales presentan una relación lineal significativa con la tasa de suicidios a nivel mundial:

En primer lugar, se realiza el contraste de hipótesis entre la tasa de suicidios y el alcoholismo para confirmar que la correlación de 0.47 obtenida en la gráfica anterior representa un resultado significativo para el problema, donde:

Hipótesis nula (Ho): No hay correlación significativa entre la la enfermedad mental (alcoholismo) y la tasa de suicidios.
Hipótesis alternativa (H1): Existe una correlación significativa entre la enfermedad mental (alcoholismo) y la tasa de suicidios.

```{r}

correlation_alcohol_suicide <- cor(data$Alcohol.use.disorders, data$SuicideRate, use = "complete.obs")

test_result <- cor.test(data$Alcohol.use.disorders, data$SuicideRate, method = "pearson")

print(test_result)
```

Como podemos observar, tienen una correlación significativa y positiva entre sí pues:

1.  **Valor p:** El valor p es muy pequeño (menor que cualquier nivel de significancia común, como 0.05), lo que indica que hay evidencia estadística significativa para rechazar la hipótesis nula. En otras palabras, hay una correlación significativa entre "Alcohol.use.disorders" y "SuicideRate".

2.  **Dirección de la correlación:** Dado que el intervalo de confianza no incluye el valor 0 y el valor de correlación es positivo (0.4678559), se puede concluir que hay una correlación positiva entre las dos variables. A medida que aumenta la tasa de trastornos por uso de alcohol, tiende a aumentar también la tasa de suicidio.

3.  **Intervalo de confianza:** El intervalo de confianza al 95% indica que podemos estar al 95% de confianza de que la verdadera correlación está dentro del rango del 0.4388302 al 0.4959063.


En segundo lugar, se realiza el contraste de hipótesis entre la tasa de suicidios y la depresión para confirmar que la correlación de 0.32 obtenida en la gráfica de correlación anterior es correcta y también representa un resultado significativo para el problema, donde:

Hipótesis nula (Ho): No hay correlación significativa entre la la enfermedad mental (depresión) y la tasa de suicidios.
Hipótesis alternativa (H1): Existe una correlación significativa entre la enfermedad mental (depresión) y la tasa de suicidios.

```{r}
test_result_depression_suicide <- cor.test(data$Depression, data$SuicideRate, method = "pearson")

print(test_result_depression_suicide)
```

Como podemos observar, tienen una correlación significativa y positiva entre sí pues:

1.  **Valor p:** El valor p es muy pequeño (menor que cualquier nivel de significancia común, como 0.05), lo que indica que hay evidencia estadística significativa para rechazar la hipótesis nula. En otras palabras, hay una correlación significativa entre las variables "Depression" y "SuicideRate".

2.  **Dirección de la correlación:** Dado que el intervalo de confianza no incluye el valor 0 y el valor de correlación es positivo (0.320269), se puede concluir que hay una correlación positiva entre las dos variables. A medida que aumenta la variable "Depression", tiende a aumentar también la tasa de suicidio.

3.  **Intervalo de confianza:** El intervalo de confianza al 95% indica que se puede estar seguro al 95% de confianza de que la verdadera correlación está dentro del rango del 0.2871029 al 0.3526682.

Es cierto, que la correlación no implica causalidad, por tanto hay que tener en cuenta que estos resultados son los obtenidos para este dataset en concreto, pero podrían variar en algún otro dataset.


Una vez hemos obtenido las dos enfermedades mentales que representan evidencias relacionales más significativas respecto a la tasa de suicidios en los países del mundo por cada 100000 habitantes, continuamos con la obtención de la información relevante para solucionar el problema planteado.

```{r}
nuevo_dataset <- data[, c("Year", "Depression", "Alcohol.use.disorders", "SuicideRate")]

head(nuevo_dataset)
```
Árbol de decisión Alcoholismo/Depresión - Tasa de Suicidios:

En este apartado, utilizamos la técnica de árbol de regresión para investigar cómo los trastornos por consumo de alcohol y depresión, pueden estar relacionados con las tasas de suicidio. Para ello, se ha realizado una "construcción" de un árbol de regresión que muestra cómo estos factores se relacionan entre sí con las tasas de suicidio. 


```{r}
#install.packages("rpart")
#install.packages("rpart.plot")

library(rpart)
library(rpart.plot)

datos_regresion <- data[, c("Alcohol.use.disorders", "Depression", "SuicideRate")]

modelo_arbol <- rpart(SuicideRate ~ Alcohol.use.disorders + Depression, data = datos_regresion)

rpart.plot(modelo_arbol)
```
Como podemos observar, el funcionamiento del modelo de árbol de regresión muestra cómo se relacionan las variables predictoras (alcoholismo y depresión) con la variable de respuesta (tasas de suicidio) en el contexto del conjunto de datos utilizado.
Por ejemplo, si un país tiene una tasa de alcoholismo mayor o igual de 3.1 y tiene una tasa de depresión mayor o igual de 4.2, dicho país tendrá una tasa de 36 suicidios por cada 100000 habitantes, representando el 1% de posibilidades de que esto ocurra.
Este árbol y los caminos que van formando sus ramas nos ayuda a comprender cómo influyen las variables predictoras con respecto a la tasa de suicidio en el conjunto de datos analizado.

Serie Temporales
Una vez hemos empleado una técnica para observar una predicción de la tasa de suicidios frente a las dos enfermedades mentales más significativas del conjunto de datos, nos aventuramos a realizar una predicción de la tasa de suicidios en los próximos cinco años (a partir del último año del dataset seleccionado: 2017) empleando la técnica de series temporales. 
```{r}
library(dplyr)

nuevo_dataset_agrupado <- data %>%
  group_by(Year) %>%
  summarise(
    Depression = mean(Depression, na.rm = TRUE),
    Alcohol_use_disorders = mean(Alcohol.use.disorders, na.rm = TRUE),
    SuicideRate = mean(SuicideRate, na.rm = TRUE)
  )

head(nuevo_dataset_agrupado)
```

Para ello, se ha resumido el conjunto de datos seleccionado y se han agrupado los datos por año para entender cómo estas variables han cambiado en promedio a lo largo del tiempo (entre el 2000 y el 2017). Utilizando este conjunto de datos agrupados, se continúa empleando la técnica de series temporales a través del método arima.

El método ARIMA (Autoregressive Integrated Moving Average) se utiliza en este contexto para modelar y predecir el diferentes tasas relacionadas  con el número de suicidios y enfermedades mentales,  a partir de un conjunto de datos de series temporales. Primeramente, se se utiliza la función auto.arima(), que selecciona automáticamente los parámetros del modelo ARIMA que mejor se ajustan a los datos observados. Luego, se generan predicciones futuras utilizando la función forecast(). Esta función utiliza el modelo ARIMA ajustado para predecir el número de suicidios en  5 años hacia adelante.

En este contexto, los resultados obtenidos se representan a través de las siguientes variables proporcionadas por el modelo utilizado:

Point Forecast: estimación puntual del número de suicidios para el período de 5 años hacia delante.

Lo 80: límite inferior del intervalo de predicción del 80%. Esto significa que hay un 80% de probabilidad de que el verdadero valor esté por encima de este límite y un 20% de probabilidad de que esté por debajo.

Hi 80: límite superior del intervalo de predicción del 80%. Similarmente al límite inferior, hay un 80% de probabilidad de que el verdadero valor esté por debajo de este límite y un 20% de probabilidad de que esté por encima.

Lo 95: límite inferior del intervalo de predicción del 95%. Hay un 95% de probabilidad de que el verdadero valor esté por encima de este límite y un 5% de probabilidad de que esté por debajo.

Hi 95: límite superior del intervalo de predicción del 95%. Hay un 95% de probabilidad de que el verdadero valor esté por debajo de este límite y un 5% de probabilidad de que esté por encima.


A continuación, se observan los resultados que representas las predicciones de la tasa de suicidios y el porcentaje de personas en el mundo con trastornos de alcoholismo y depresión para los próximos 5 años en función de las estimaciones proporcionadas por el modelo ARIMA (en forma de intervalos de confianza del 80% y del 95%.) tanto en forma de tabla como de forma visual a través de una gráfica.

Hay que tener en cuenta que las gráficas que representan estas estimaciones muestran una línea negra que representa a la variable "Point Forecast", un área de color azul oscura, entre la que se encuentra la línea, que representa los límites de predicción (Hi/Lo) del 95% y un área de color azul claro que representa los límites de predicción (Hi/Lo) del 80%. En otras palabras, los valores de las áreas por encima de la línea de los valores estimados en la variable "Point Forecast" equivalen a los límites de predicción Hi y, los valores de las áreas por debajo de la línea de los valores estimados en la variable "Point Forecast", equivalen a los límites de predicción Lo.

Predicción de la tasa de suicidios por 100000 habitantes en los próximos 5 años:
```{r}
#install.packages("readr")
#install.packages("ggplot2")
#install.packages("forecast")
#install.packages("tibble")

library(readr)
library(ggplot2)
library(forecast)
library(tibble)
library(dplyr)

data_st <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_de_suicidios = SuicideRate) 

data_st$Year <- as.Date(data_st$Year, format = "%Y")

data_st <- as_tibble(data_st)

modelo_arima <- auto.arima(data_st$Numero_de_suicidios)

predicciones <- forecast(modelo_arima, h = 5)

print(predicciones)

```



```{r}
autoplot(predicciones) + labs(title = "Predicciones de suicidios para los próximos 5 años")
```

Como podemos observar, el valor de la predicción de la tasa de suicidios en los próximos cinco años continúa con la tendencia de bajada para todas las estimaciones del modelo ajustado, es decir, tanto para la variable "Point Forecast" como para los límites del intervalo de predicción Lo y Hi, llegando a una tasa de 8.82 suicidios por cada 100000 habitantes en el año 2023. Por ello, podemos afirmar que durante los periodos estimados, se prevee que la tasa de suicidios en el mundo tienda a decrecer, mostrando una continuación de dicho decrecimiento en los años próximos.

Predicción del porcentaje de personas con depresión por en los próximos 5 años:
```{r}
data_dp <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_Depresion = Depression) 

data_dp$Year <- as.Date(data_dp$Year, format = "%Y")

data_dp <- as_tibble(data_dp)

modelo_arima_depre <- auto.arima(data_dp$Numero_Depresion)

predicciones_depre <- forecast(modelo_arima_depre, h = 5)

print(predicciones_depre)
```

```{r}
autoplot(predicciones_depre) + labs(title = "Predicciones de depresión para los próximos 5 años")
```
Tal y como se muestra en la gráfica, por desgracia, observamos aumento constante en las estimaciones si observamos la variable "Point Forecast" y los límites del intervalo de predicción Hi, aunque no es muy brusco pues hay una diferencia de, aproximadamente 0.01 entre el porcentaje de depresión del año 2017 y la estimación de esta enfermedad para el año 2023. Sin embargo, los límites del intervalo predicción Lo muestran un decrecimiento a medida que avanzan los períodos. Por ello, podemos afirmar que durante los periodos estimados, el porcentaje de personas en el mundo con depresión se mantiene prácticamente constante, aunque muestra una tendencia al crecimiento durante los años próximos.


Predicción del porcentaje de personas con alcoholismo por en los próximos 5 años:
```{r}
data_al <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_Alcohol = Alcohol_use_disorders) 

data_al$Year <- as.Date(data_al$Year, format = "%Y")

data_al <- as_tibble(data_al)

modelo_arima_al <- auto.arima(data_al$Numero_Alcohol)

predicciones_al <- forecast(modelo_arima_al, h = 5)

print(predicciones_al)
```

```{r}
autoplot(predicciones_al) + labs(title = "Predicciones de alcoholismo para los próximos 5 años")
```

Finalmente, en la gráfica que representa la estimación del porcentaje de personas con problemas de alcoholismo a nivel mundial en los próximos cinco años, podemos observar que la gráfica descrita por la variable "Point Forecast" continúa con la tendencia de bajada comenzada a partir de los años 2010-2015, tras un crecimiento en 5 años anteriores, obteniendo un valor de, aproximadamente 1.53% de personas con problemas de alcoholismo en el mundo en 2022. Los límites del intervalo de predicción Lo, también muestran un decrecimiento continuo en los años estimados, sin embargo, los valores estimados en los límites del intervalo de predicción Hi muestran una tendencia a decrecer en los próximos años. Como la diferencia entre las estimaciones es del orden de números centésimales, podemos afirmar que prácticamente la gráfica se mantiene constante durante los años estimados, por debajo del pico máximo obtenido en 2012, con una tendencia al decrecimiento en años posteriores.

En conclusión, podemos comentar que los aspectos más importantes y significativos de este proyecto son:

Correlación entre trastornos mentales y tasas de suicidio: Se ha demostrado estadísticamente una correlación significativa y positiva entre el porcentaje de trastornos mentales de depresión y  problemas de alcoholismo con las tasas de suicidio a nivel mundial.

Modelo de árbol de regresión: El análisis mediante un modelo de árbol de regresión ha proporcionado una comprensión detallada de cómo las enfermedades mentales más significativas, el alcoholismo y la depresión, se relacionan con las tasas de suicidio. Esto ofrece una herramienta útil para identificar los factores que contribuyen significativamente al aumento de las tasas de suicidio.

Predicciones a través de series temporales: La aplicación de técnicas de series temporales ha permitido proyectar las tasas de suicidio y el porcentaje de personas con depresión y problemas de alcoholismo en el mundo en los próximos años. De hecho, si observamos datos en bases de datos de confianza, podemos observar que los valores obtenidos no difieren mucho de lo que se ha estimado. Por ejemplo, según una noticia de la Organización Mundial de la Salud de 2023 indica que un porcentaje de 3,8% de personas pueden padecer depresión en el mundo y el modelo  definido en este proyecto estima que, aproximadamente, el 3,44% de personas en el mundo padecen depresión.

Causalidad vs. correlación: Si bien se ha demostrado una correlación significativa entre los trastornos mentales y las tasas de suicidio, es importante tener en cuenta que la correlación no implica causalidad. Es decir, existen otros factores diferentes a los factores de la salud que también pueden influir en esta relación, como por ejemplo, factores sociales y/o demográficos. Por lo tanto, como futuras investigaciones queda abierta la puerta de realizar más investigaciones para comprender completamente los factores que pueden influir en la tasa de suicidios.

Para finalizar, cabe resaltar que estas conclusiones resaltan la importancia de abordar los trastornos de salud como componentes clave en la prevención del suicidio a nivel mundial promoviendo estrategias que fomenten el cuidado de la salud mental y el bienestar emocional en toda la población en general.