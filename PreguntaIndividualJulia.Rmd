---
title: "PreguntaJulia"
author: "Julia"
date: "2024-03-06"
output: html_document
---

Lectura del dataset elegido:

```{r}
data <- read.csv("data/dataMH.csv")
head(data)
```

Elimino las columnas con valores repetidos que no me aportan información:

```{r}
data <- subset(data, select = -c(Code, DIM_SEX))
head(data)
```

Cálculo de la correlación de las distintas variables, con el fin de descubrir cuales están más relacionadas con la tasa de suicidios.

```{r}
library(dplyr)
library(corrplot)


data <- data %>% rename(SuicideRate = VALUE_NUMERIC)

data_total <- data[, c("Schizophrenia", "Bipolar.disorders", "Eating.disorders", "Anxiety.disorders", "Drug.use.disorders", "Depression", "Alcohol.use.disorders", "SuicideRate")]

correlation_matrix <- cor(data_total, use = "pairwise.complete.obs")

corrplot(correlation_matrix, method = "color", type = "upper", order = "hclust", 
         tl.cex = 0.8, tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)
```

Contraste de hipótesis de las variables de mayor correlación con la tasa de suicidios, para comprobar la relación entre ambas variables:

En primer lugar, realizo el contraste entre la tasa de suicidios y el alcohlísmo para confirmar que la correlación de 0.47 ontenida en la gráfica anterior es correcta.

```{r}

correlation_alcohol_suicide <- cor(data$Alcohol.use.disorders, data$SuicideRate, use = "complete.obs")

test_result <- cor.test(data$Alcohol.use.disorders, data$SuicideRate, method = "pearson")

print(test_result)
```

Como podemos observar, tienen una correlación significativa y positiva entre sí:

1.  **Valor p:** El valor p es muy pequeño (menor que cualquier nivel de significancia común, como 0.05), lo que indica que hay evidencia estadística significativa para rechazar la hipótesis nula. En otras palabras, hay una correlación significativa entre "Alcohol.use.disorders" y "SuicideRate".

2.  **Dirección de la correlación:** Dado que el intervalo de confianza no incluye el valor 0 y el valor de correlación es positivo (0.4678559), puedes concluir que hay una correlación positiva entre las dos variables. A medida que aumenta la tasa de trastornos por uso de alcohol, tiende a aumentar también la tasa de suicidio.

3.  **Intervalo de confianza:** El intervalo de confianza al 95% indica que puedes estar 95% seguro de que la verdadera correlación está dentro del rango del 0.4388302 al 0.4959063.

En segundo lugar, realizo el contraste entre la tasa de suicidios y la depresión para confirmar que la correlación de 0.32 obtenida en la gráfica de correlación anterior es correcta.

```{r}
test_result_depression_suicide <- cor.test(data$Depression, data$SuicideRate, method = "pearson")

print(test_result_depression_suicide)
```

Como podemos observar, tienen una correlación significativa y positiva entre sí:

1.  **Valor p:** El valor p es muy pequeño (menor que cualquier nivel de significancia común, como 0.05), lo que indica que hay evidencia estadística significativa para rechazar la hipótesis nula. En otras palabras, hay una correlación significativa entre "Depression" y "SuicideRate".

2.  **Dirección de la correlación:** Dado que el intervalo de confianza no incluye el valor 0 y el valor de correlación es positivo (0.320269), puedes concluir que hay una correlación positiva entre las dos variables. A medida que aumenta la variable "Depression", tiende a aumentar también la tasa de suicidio.

3.  **Intervalo de confianza:** El intervalo de confianza al 95% indica que puedes estar 95% seguro de que la verdadera correlación está dentro del rango del 0.2871029 al 0.3526682.

Es cierto, que la correlación no implica causalidad, por tanto hay que tener en cuenta que estos resultados son los obtenidos para este dataset en concreto, podrían variar en algún otro dataset.

```{r}

nuevo_dataset <- data[, c("Year", "Depression", "Alcohol.use.disorders", "SuicideRate")]

head(nuevo_dataset)
```

```{r}
library(dplyr)

nuevo_dataset_agrupado <- data %>%
  group_by(Year) %>%
  summarise(
    Media_Depression = mean(Depression, na.rm = TRUE),
    Media_Alcohol_use_disorders = mean(Alcohol.use.disorders, na.rm = TRUE),
    Media_SuicideRate = mean(SuicideRate, na.rm = TRUE)
  )

head(nuevo_dataset_agrupado)
```


```{r}
#install.packages("rpart")
#install.packages("rpart.plot")

library(rpart)
library(rpart.plot)

datos_regresion <- data[, c("Alcohol.use.disorders", "Depression", "SuicideRate")]

modelo_arbol <- rpart(SuicideRate ~ Alcohol.use.disorders + Depression, data = datos_regresion)

rpart.plot(modelo_arbol)
```


```{r}
# Instalar y cargar las bibliotecas necesarias
#install.packages("readr")
#install.packages("ggplot2")
#install.packages("forecast")
#install.packages("tibble")

library(readr)
library(ggplot2)
library(forecast)
library(tibble)
library(dplyr)

data_st <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_de_suicidios = Media_SuicideRate) 

data_st$Year <- as.Date(data_st$Year, format = "%Y")

data_st <- as_tibble(data_st)

modelo_arima <- auto.arima(data_st$Numero_de_suicidios)

predicciones <- forecast(modelo_arima, h = 5)

print(predicciones)

```



```{r}
autoplot(predicciones) + labs(title = "Predicciones de suicidios para los próximos 5 años")
```

```{r}
data_dp <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_Depresion = Media_Depression) 

data_dp$Year <- as.Date(data_dp$Year, format = "%Y")

data_dp <- as_tibble(data_dp)

modelo_arima_depre <- auto.arima(data_dp$Numero_Depresion)

predicciones_depre <- forecast(modelo_arima_depre, h = 5)

print(predicciones_depre)
```

```{r}
autoplot(predicciones_depre) + labs(title = "Predicciones de depresión para los próximos 5 años")
```

```{r}
data_al <- nuevo_dataset_agrupado %>% 
  select(Year, Numero_Alcohol = Media_Alcohol_use_disorders) 

data_al$Year <- as.Date(data_al$Year, format = "%Y")

data_al <- as_tibble(data_al)

modelo_arima_al <- auto.arima(data_al$Numero_Alcohol)

predicciones_al <- forecast(modelo_arima_al, h = 5)

print(predicciones_al)
```

```{r}
autoplot(predicciones_al) + labs(title = "Predicciones de alcoholismo para los próximos 5 años")
```

