---
title: "Data Science"
author: "Julia, Cristian"
date: "2024-02-19"
output: html_document
---

```{r}
datosMH <- read.csv("data/2.globalTrendsinMentalHealth/Mental health Depression disorder Data2.csv")
head(datosMH)
```
Para mantener una cohesión y una mejor organización del conjunto de datos, decidimos eliminar la columna "index" pues el entorno de programación ya tiene en cuenta una columna para el índice. 

```{r}
# Eliminación de la columna 'index'
datosMH <- subset(datosMH, select = -index)
```


```{r}
summary(datosMH)
str(datosMH)
```
datosMH:

index: Un índice numérico.
Entity: El país o entidad asociada con los datos.
Code: El código del país.
Year: El año al que pertenecen los datos.
Schizophrenia, Bipolar.disorders, Eating.disorders, Anxiety.disorders, Drug.use.disorders, Depression, Alcohol.use.disorders: Diferentes tipos de trastornos de salud mental y sus tasas correspondientes.

Tamaño del conjunto: 108553

```{r}
missing_values_mh <- colSums(is.na(datosMH))
print("Datos faltantes en datosMH:")
print(missing_values_mh)
```
Como podemos observar, aparecen muchos valores nulos en las variables "Eating.disorders", "Anxiety.disorders", "Drug.use.disorders" "Depression" y "Alcohol.use.disorders" (casi el 80% de sus datos son nulos), sin embargo, en el resto de las variables no aparece ningún valor faltante. Analizando el fichero, nos hemos dado cuenta de que contiene un error en su composición pues parece ser que hay varios atributos que han sido insertados como filas a partir de la fila número 6469.

```{r}
datosMH1 <- datosMH[1:6468, ]
datosMH2 <- datosMH[6469:54276, ]
datosMH3 <- datosMH[54277:102084, ]
datosMH4 <- datosMH[102085: nrow(datosMH), ]

head(datosMH1)
head(datosMH2)
head(datosMH3)
head(datosMH4)
```

```{r}
#Preprocesamiento datosMH2
colnames(datosMH2) <- datosMH2[1,]
datosMH2 <- subset(datosMH2, select = -c(7:10))
datosMH2 <- tail(datosMH2, -1)
rownames(datosMH2) <- NULL

#Preprocesamiento datosMH3
colnames(datosMH3) <- datosMH3[1,]
datosMH3 <- subset(datosMH3, select = -c(7:10))
datosMH3 <- tail(datosMH3, -1)
rownames(datosMH3) <- NULL

#Preprocesamiento datosMH4
colnames(datosMH4) <- datosMH4[1,]
datosMH4 <- subset(datosMH4, select = -c(5:10))
datosMH4 <- tail(datosMH4, -1)
rownames(datosMH4) <- NULL

head(datosMH1)
head(datosMH2)
head(datosMH3)
head(datosMH4)

#write.csv(datosMH1, file = "data/datosMH1.csv", row.names = FALSE)
#write.csv(datosMH2, file = "data/datosMH2.csv", row.names = FALSE)
#write.csv(datosMH3, file = "data/datosMH3.csv", row.names = FALSE)
#write.csv(datosMH4, file = "data/datosMH4.csv", row.names = FALSE)
```
En esta etapa, acabamos de obtener cuatro datasets a partir de uno proporcionado y hemos realizado un proceso de preprocesamiento de tres de los cuatro conjuntos de datos resultantes, datosMH2, datosMH3, y datosMH4, obtenidos a partir del conjunto de datos original (datosMH). Primero, se renombran las columnas de cada conjunto de datos utilizando los valores de la primera fila como nombres de columna. Luego, se eliminan las columnas que contenían todas las variables nulas de cada conjunto de datos (debido a la superposición de los cuatro datasets en uno). Posteriormente, se elimina la primera fila de cada conjunto de datos para asegurar la coherencia estructural y se restablecen los índices de fila para iniciar desde 1, lo que facilita el acceso y manejo de los datos en análisis posteriores. Continuamos realizando un análisis básico de cada conjunto de datos obtenido, pero para ello, antes debemos pasar cada variable a su tipo correspondiente, por ejemplo, "Year" aparece como "character" y debe ser de tipo "integer", o, todas las variables que representan un tipo de trastorno de salud mental deben ser de tipo "double" en vez de tipo "character" como aparecen algunas.

```{r}
print("Resumen de datosMH1")
summary(datosMH1)
print("Resumen de datosMH2")
summary(datosMH2)
print("Resumen de datosMH3")
summary(datosMH3)
print("Resumen de datosMH4")
summary(datosMH4)
```

De forma resumida, podemos indicar una breve descripción de los atributos que contiene cada conjunto de datos extraído del conjunto de datos original:

Resumen de datosMH1:
Entity: Países.
Code: Código identificador de los paises.
Year: Año en los que se recogieron los datos.
Schizophrenia: Datos relacionados con la esquizofrenia.
Bipolar.disorders: Datos relacionados con trastornos bipolares.
Eating.disorders: Datos relacionados con trastornos alimentarios.
Anxiety.disorders: Datos relacionados con trastornos de ansiedad.
Drug.use.disorders: Datos relacionados con trastornos por consumo de drogas.
Depression: Datos relacionados con la depresión.
Alcohol.use.disorders: Datos relacionados con trastornos por consumo de alcohol.

Resumen de datosMH2:
Entity: Países.
Code: Código identificador de los paises.
Year: Año en los que se recogieron los datos.
Prevalence in males (%): Prevalencia en hombres (%).
Prevalence in females (%): Prevalencia en mujeres (%).
Population: Nº de habitantes en el país en cada año.

Resumen de datosMH3:
Entity: Países.
Code: Código identificador de los paises.
Year: Año en los que se recogieron los datos.
Suicide rate (deaths per 100000 individuals): Tasa de suicidio (muertes por cada 100,000 individuos).
Depressive disorder rates (number suffering per 100000): Tasas de trastorno depresivo (número de personas que sufren por cada 100,000).
Population: Nº de habitantes en el país en cada año.

Resumen de datosMH4:
Entity: Países.
Code: Código identificador de los paises.
Year: Año en los que se recogieron los datos.
Prevalence - Depressive disorders - Sex: Both - Age: All Ages (Number) (people suffering from depression): Prevalencia de trastornos depresivos - Sexo: Ambos - Edad: Todas las edades (Número) (personas que sufren de depresión).

Analizando el resto de conjunto de datoso obtenidos por el equipo, analizamos que había un dataset que muestra la tasa de suicidos por sexo y año en cada país del mundo. Por ello, decidimos utilizar este conjunto de datos para nuestro proyecto.

```{r}
data_suicide <-  read.csv("data/1.OMSTasaMortalidadSuicidio/tasa_suicidio_por_pais.csv")
library(dplyr)
data_suicide <- data_suicide %>%
  rename(Entity = GEO_NAME_SHORT, Year = DIM_TIME, SuicideRate = VALUE_NUMERIC)
head(data_suicide)
```

```{r}
dataMH <- merge(datosMH1, data_suicide, by = c("Entity","Year"))
dataMH <- dataMH %>% filter(DIM_SEX == "Total")
#write.csv(dataMH, file = "data/dataMH.csv", row.names = FALSE)
head(dataMH)
summary(dataMH)
```

Resumen de dataMH:
Entity: Países.
Code: Código identificador de los paises.
Year: Año en los que se recogieron los datos.
Schizophrenia: Datos relacionados con la esquizofrenia.
Bipolar.disorders: Datos relacionados con trastornos bipolares.
Eating.disorders: Datos relacionados con trastornos alimentarios.
Anxiety.disorders: Datos relacionados con trastornos de ansiedad.
Drug.use.disorders: Datos relacionados con trastornos por consumo de drogas.
Depression: Datos relacionados con la depresión.
Alcohol.use.disorders: Datos relacionados con trastornos por consumo de alcohol.
DIM_SEX: Datos relacionados con el sexo de las personas incluidas en la tasa de suicios (masculino y femenino).
SuicideRate: Tasa de suicidios en los países en un año concreto por cada 100000 habitantes.

```{r}
missing_values_mh <- colSums(is.na(dataMH))
print("Datos faltantes en dataMH:")
print(missing_values_mh)
```

En el conjunto de datos "datosMH", no se observan datos faltantes en ninguna de las variables registradas. Tanto las variables relacionadas con trastornos mentales (esquizofrenia, depresión trastornos bipolares, trastornos alimentarios, trastornos de ansiedad, trastornos por consumo de drogas, alcohol) obtenidas del primer dataset original, así como las variables adicionales "DIM_SEX" y "SuicideRate" (tasa de suicidio), obtenidas del segundo dataset original también carecen de datos faltantes en su unión en un dataset conjunto/general.


```{r}
dataMH$Year <- as.integer(dataMH$Year)
dataMH$Schizophrenia <- as.double(dataMH$Schizophrenia)
dataMH$Bipolar.disorders <- as.double(dataMH$Bipolar.disorders)
dataMH$Eating.disorders <- as.double(dataMH$Eating.disorders)
```
En este apartado, se realiza una conversión de tipología de los datos de la siguiente manera:
La variable "Year" se convierte a tipo de datos entero (integer).
Las variables "Schizophrenia", "Bipolar.disorders" y "Eating.disorders" se convierten a tipo de datos de punto flotante (double).
Estas conversiones pueden ser útiles para asegurarse de que los tipos de datos sean los adecuados para el análisis posterior del conjunto de datos general.


```{r}
# Seleccionar las variables de interés
variables <- c("Schizophrenia", "Bipolar.disorders", "Eating.disorders", 
                       "Anxiety.disorders", "Drug.use.disorders", "Depression", 
                       "Alcohol.use.disorders", "SuicideRate")
par(mfrow=c(2, 4))
for (variable in variables) {
  boxplot(dataMH[[variable]], main = variable, ylab = "Valor")
}

```

Según los datos observados, podemos comentar que:
Schizophrenia: La distribución de la variable "Schizophrenia" muestra una mediana aproximadamente en 0.2, con un rango intercuartílico (IQR) que va desde aproximadamente 0.17 hasta 0.29, con algunos valores atípicos en el extremo superior del rango.

Bipolar.disorders: Para la variable "Bipolar.disorders", la mediana se encuentra alrededor de 0.7, con un IQR que va desde aproximadamente 0.6 hasta 0.8. Se observa que prácticamente no hay valores atípicos en el extremo superior ni tampoco en el extemo inferior del rango. valores mínimos y máximos de 0.3189 y 1.2066, respectivamente.

Eating.disorders: La mediana de la variable "Eating.disorders" es aproximadamente 0.18337, con un IQR que va desde alrededor de 0.12392 hasta 0.27564. Se observan valores atípicos en el extremo superior del rango, con un mínimo de 0.07638 y un máximo de 0.94399.

Anxiety.disorders, Drug.use.disorders, Depression y Alcohol.use.disorders: No se proporciona información sobre estos datos en la tabla dada. Si necesitas resúmenes para estas variables, necesitaría los estadísticos descriptivos correspondientes.

SuicideRate: La mediana de la variable "SuicideRate" es aproximadamente 8.225, con un IQR que va desde alrededor de 4.888 hasta 13.125. Se observan valores atípicos en el extremo superior del rango, con un mínimo de 0.000 y un máximo de 92.641. Cabe resaltar que el el valor mínimo se acerca más a la media y la mediana que el valor máximo.

```{r}
dataMH_disorders <- dataMH[, c("Schizophrenia", "Bipolar.disorders", "Eating.disorders","Anxiety.disorders", "Drug.use.disorders", "Depression", "Alcohol.use.disorders")]

head(dataMH_disorders)
```

```{r}
missing_values_mh_d <- colSums(is.na(dataMH_disorders))
print("Datos faltantes en datosMH:")
print(missing_values_mh_d)
```

```{r}
library(corrplot)
correlation_matrix_disorders <- cor(dataMH_disorders, use = "pairwise.complete.obs")
plot.new()
corrplot(correlation_matrix_disorders, method = "color", type = "upper", order = "hclust", 
         tl.cex = 0.8, tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)
```



```{r}
dataMH_res <- dataMH[, c("Schizophrenia", "Bipolar.disorders", "Eating.disorders", 
                                     "Anxiety.disorders", "Drug.use.disorders", "Depression", 
                                     "Alcohol.use.disorders", "SuicideRate")]
head(dataMH_res)
summary(dataMH_res)
```

Según los datos observados, podemos comentar que:
Schizophrenia: La distribución de la variable "Schizophrenia" muestra una mediana aproximadamente en 0.1981, con un rango intercuartílico (IQR) que va desde aproximadamente 0.1764 hasta 0.2261. Los valores oscilan entre 0.1483 y 0.3671, con algunos valores atípicos en el extremo superior del rango.

Bipolar.disorders: Para la variable "Bipolar.disorders", la mediana se encuentra alrededor de 0.6993, con un IQR que va desde aproximadamente 0.6224 hasta 0.8348. Hay valores atípicos tanto en el extremo superior como en el inferior del rango, con valores mínimos y máximos de 0.3189 y 1.2066, respectivamente.

Eating.disorders: La mediana de la variable "Eating.disorders" es aproximadamente 0.18337, con un IQR que va desde alrededor de 0.12392 hasta 0.27564. Se observan valores atípicos en el extremo superior del rango, con un mínimo de 0.07638 y un máximo de 0.94399.

Anxiety.disorders, Drug.use.disorders, Depression y Alcohol.use.disorders: No se proporciona información sobre estos datos en la tabla dada. Si necesitas resúmenes para estas variables, necesitaría los estadísticos descriptivos correspondientes.

SuicideRate: La mediana de la variable "SuicideRate" es aproximadamente 8.225, con un IQR que va desde alrededor de 4.888 hasta 13.125. Se observan valores atípicos en el extremo superior del rango, con un mínimo de 0.000 y un máximo de 92.641. Cabe resaltar que el el valor mínimo se acerca más a la media y la mediana que el valor máximo.




```{r}
correlation_matrix <- cor(dataMH_res, use = "pairwise.complete.obs")
plot.new()
corrplot(correlation_matrix, method = "color", type = "upper", order = "hclust", 
         tl.cex = 0.8, tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)
```

```{r}
correlation_subset <- correlation_matrix["SuicideRate", -1, drop = FALSE]
plot.new()
corrplot(correlation_subset, method = "color", type = "upper", tl.cex = 0.8, tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)

```




